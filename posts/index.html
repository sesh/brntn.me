<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <title>Brenton Cleeland</title>

    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

    <header>
        <h1>Brenton Cleeland</h1>
        <nav>
            <a href="/posts/">Posts</a>
            <a href="/">Home</a>
        </nav>
    </header>

    <main>
    <article class="h-entry">
    <a href="/2021/trigger-build-with-github-action" class="u-url">
        <time class="post-date dt-published" datetime="2021-01-26">January 26, 2021</time>
    </a>

    <div class="e-content">
        <h1>Building brntn.me when another Github Repo changes using Github Actions</h1>
<p>The repository that builds my website (<a href="https://github.com/sesh/brntn.me">sesh/brntn.me</a>) pulls in content from a number of other repositories. I wanted my site to automatically rebuild any time one of those other repositories is updated.</p>
<p>There's a few examples of how to do this out there, but I wanted to jot down my quick and dirty solution in case it's helpful for anyone else.</p>
<p>We're going to be working with two different repositories here, so lets name them to make things simpler:</p>
<ul>
<li><code>parent-repo</code> is the main repository. It should already have a Github Action that builds the site. In my case this is the repository for this website.</li>
<li><code>child-repo</code> is a second repository that should trigger the build of <code>parent-repo</code> on change.</li>
</ul>
<h2>Step One: Add <code>repository_dispatch</code> to your build Github Action for <code>parent-repo</code></h2>
<p>In the <code>on</code> block of the Github Action that builds your project add a new <code>repository_dispatch</code> block. The <code>repository_dispatch</code> allows calls to the Github API to trigger your action. The <code>types</code> list is a list of dispatch types that will be used as triggers, in our case, we're going to add a single <code>build</code> type (we'll use this later).</p>
<pre><code class="language-yaml">on:
  repository_dispatch:
    types:
      - build
</code></pre>
<h2>Step Two: Generate a Personal Access Token with <code>repo</code> permissions</h2>
<p>In order to trigger the build you'll need a Personal Access token that has the <code>repo</code> set of scopes. You can create this from the <a href="https://github.com/settings/tokens">Developer Settings</a> section of your Github settings.</p>
<h2>Step Three: Add the secret to <code>child-repo</code></h2>
<p>In the Secrets section of the <code>child-repo</code> settings add the token that you just generated as a Repository Secret. I've named mine <code>NOTIFY_TOKEN</code> (you'll need this in the next step).</p>
<h2>Step Four: Add the Notify action to <code>child-repo</code></h2>
<p>The final step is to add a new action to your <code>child-repo</code> that triggers the build. This action uses the <code>NOTIFY_TOKEN</code> created above. You'll need to manually update the action with the <code>parent-repo</code> name (see placeholder below).</p>
<p>For my projects I've put this in <code>.github/workflows/notify.yml</code>:</p>
<pre><code>name: Trigger rebuild of parent repo
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-20.04
    container: alpine/httpie
    steps:
      - name: Notify parent repo
        run: http post https://api.github.com/repos/&lt;&lt;YOUR_PARENT_REPO&gt;&gt;/dispatches &quot;Authorization:token ${{ secrets.NOTIFY_TOKEN }}&quot; event_type=build --ignore-stdin
</code></pre>
<p>And that's it! When your <code>child-repo</code> actions run (and we have it set to run on all pushes) it will trigger a build in the parent repo.</p>

    </div>
</article>

<article class="h-entry">
    <a href="/photos/14a6065c-7d76-4926-9bd4-5b9c509a33da/" class="u-url">
        <time class="post-date dt-published" datetime="2019-02-22T13:00:00Z">February 22, 2019</time>
    </a>

    <div class="e-content">
        <p><img src="https://brntn-photos.s3-ap-southeast-2.amazonaws.com/uploaded/F54F676E-ACF8-4D4E-8854-E2E6293CCC90.jpeg" alt="" /></p>
<p>Sunset ðŸ˜ƒ</p>

    </div>
</article>

<article class="h-entry">
    <a href="/photos/a7f8e204-aa98-484e-a226-c8e52101033b/" class="u-url">
        <time class="post-date dt-published" datetime="2019-02-21T13:00:00Z">February 21, 2019</time>
    </a>

    <div class="e-content">
        <p><img src="https://brntn-photos.s3-ap-southeast-2.amazonaws.com/uploaded/163E38B9-FFC9-4CED-8D8A-7EA272F82569.jpeg" alt="" /></p>
<p>I donâ€™t think Iâ€™ll ever get over our backyard at sunset</p>

    </div>
</article>

<article class="h-entry">
    <a href="/photos/25a0b0dc-e3eb-44d8-ac41-c23b7b7f8aab/" class="u-url">
        <time class="post-date dt-published" datetime="2019-02-20T13:00:00Z">February 20, 2019</time>
    </a>

    <div class="e-content">
        <p><img src="https://brntn-photos.s3-ap-southeast-2.amazonaws.com/uploaded/277BF316-C68E-46F3-B3FB-8E9A1B9ABA78.jpeg" alt="" /></p>
<p>Took a very different route to the steps this evening.</p>

    </div>
</article>

<article class="h-entry">
    <a href="/photos/118f663a-a4dd-4b35-b028-efe5b8e7a3d4/" class="u-url">
        <time class="post-date dt-published" datetime="2019-02-19T13:00:00Z">February 19, 2019</time>
    </a>

    <div class="e-content">
        <p><img src="https://brntn-photos.s3-ap-southeast-2.amazonaws.com/uploaded/1F850E20-F372-489F-8268-E6066D5D6F2B.jpeg" alt="" /></p>
<p>Canâ€™t wait to hang this in our sonâ€™s room :)</p>

    </div>
</article>

<div class='pagination'><a href='/posts/page-1.html'>Next &rarr;</a></div>
    </main>
</body>
</html>
